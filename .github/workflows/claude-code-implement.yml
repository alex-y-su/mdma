name: Claude Code Implement Issue

on:
  issues:
    types: [labeled]

jobs:
  implement:
    # Only run when the 'claude' label is added
    if: github.event.label.name == 'claude'
    runs-on: ubuntu-latest
    permissions:
      contents: write
      pull-requests: write
      issues: write
      id-token: write

    steps:
      - name: Checkout repository
        uses: actions/checkout@v4
        with:
          ref: main
          fetch-depth: 0

      - name: Run Claude Code Implementation
        uses: anthropics/claude-code-action@v1
        with:
          claude_code_oauth_token: ${{ secrets.CLAUDE_CODE_OAUTH_TOKEN }}

          # Use direct_prompt for issue implementation
          direct_prompt: |
            You are implementing GitHub issue #${{ github.event.issue.number }}.

            CRITICAL INSTRUCTIONS - READ CAREFULLY:

            1. First, read the FULL issue using: gh issue view ${{ github.event.issue.number }}

            2. This is an i18n task. You must:
               - Add `useTranslation` hook to React components
               - Replace ALL hardcoded strings with `t()` calls
               - Add translation keys to BOTH frontend/locales/ AND assets/locales/ JSON files
               - Follow the exact translation key structure provided in the issue
               - Use the Russian translations provided in the issue

            3. Translate ALL components listed in the issue - not just a few. Check the issue for the complete list.

            4. After implementing ALL changes:
               - Create a new branch: git checkout -b claude/issue-${{ github.event.issue.number }}
               - Commit all changes with a descriptive message
               - Push the branch: git push -u origin claude/issue-${{ github.event.issue.number }}
               - Create a PR: gh pr create --base main --title "..." --body "..."
               - Comment on issue #${{ github.event.issue.number }} with the PR link

            DO NOT STOP until you have:
            ✓ Modified ALL component files listed in the issue
            ✓ Updated ALL translation JSON files (both en and ru, in both locations)
            ✓ Pushed your branch to origin
            ✓ Created a Pull Request
            ✓ Commented on the issue with the PR link

          # Allow all necessary tools
          allowed_tools: "Bash,Read,Write,Edit,Glob,Grep,WebFetch"

          # Increase max turns for larger tasks
          max_turns: 200
